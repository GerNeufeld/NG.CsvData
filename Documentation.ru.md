# Документация библиотеки CsvData

## Обзор
CsvData - это библиотека .NET, предназначенная для чтения и записи CSV-файлов с расширенной функциональностью. Она реализует интерфейс `IDataReader`, что делает ее совместимой с рабочими процессами обработки данных, которые ожидают этот стандартный интерфейс.

## Возможности
- Чтение и запись CSV-файлов с настраиваемыми разделителями и кавычками
- Поддержка виртуальных столбцов, которые могут вычисляться во время чтения
- Автоматическое преобразование типов данных с настраиваемым синтаксическим анализом
- Совместимость с интерфейсом `IDataReader` .NET
- Поддержка нескольких потоков и файлов
- Настраиваемые параметры кодировки и форматирования

## Установка
Библиотека создана для .NET 8.0 и может быть использована непосредственно в вашем проекте.

## Классы

### CsvDataReader
Основной класс для чтения CSV-файлов. Реализует интерфейс `ICsvDataReader`, который расширяет `IDataReader`.

#### Основные методы:
- `Open(Stream stream, CsvDataReaderOptions options = null, bool leaveOpen = false)` - Открывает CSV-поток для чтения
- `Open(string filename, CsvDataReaderOptions options = null)` - Открывает CSV-файл по имени файла
- `Read()` - Читает следующую запись
- `Close()` - Закрывает считыватель
- `GetRawRecord()` - Получает строку необработанной записи
- `IsVirtualField(int i)` - Проверяет, является ли поле виртуальным

#### Свойства:
- `FieldCount` - Количество полей в текущей записи
- `RecordsReaded` - Количество прочитанных записей
- `Headers` - Коллекция заголовков столбцов
- `Filename` - Имя исходного файла

### CsvDataWriter
Основной класс для записи CSV-файлов.

#### Основные методы:
- `CsvDataWriter(string path, CsvDataWriterOptions options = null)` - Создает записывающее устройство для пути к файлу
- `Write(string[] record)` - Записывает запись в файл
- `Write(CsvRow row)` - Записывает объект CsvRow
- `NewRow()` - Создает новый экземпляр CsvRow

### CsvColumn
Представляет столбец в CSV-файле со свойствами для имени, порядкового номера, типа данных и виртуального статуса.

### CsvDataReaderOptions
Параметры конфигурации для чтения CSV-файлов:
- `Encoding` - Кодировка текста (по умолчанию: Encoding.Default)
- `Delimiter` - Разделитель полей (по умолчанию: ";")
- `Quote` - Символ кавычки (по умолчанию: '"')
- `FirstLineIsHeader` - Содержит ли первая строка заголовки (по умолчанию: true)
- `IgnoreBlankLines` - Игнорировать ли пустые строки (по умолчанию: true)
- `VirtualFields` - Список виртуальных полей для добавления

### CsvDataWriterOptions
Параметры конфигурации для записи CSV-файлов:
- `Encoding` - Кодировка текста (по умолчанию: Encoding.Default)
- `Delimiter` - Разделитель полей (по умолчанию: ";")
- `Quote` - Символ кавычки (по умолчанию: '"')
- `RequireFieldQuotation` - Требуется ли кавычка для поля (по умолчанию: false)
- `Headers` - Список заголовков для записи

## Примеры использования

### Чтение CSV-файла
```csharp
using NG.CsvData;

var reader = CsvDataReader.Open("data.csv");
while(reader.Read())
{
    string firstName = reader["FirstName"].ToString();
    string lastName = reader["LastName"].ToString();
    // Обработка данных
}
reader.Dispose();
```

### Запись CSV-файла
```csharp
using NG.CsvData;

var options = new CsvDataWriterOptions()
{
    Headers = new List<string> {"Name", "Age", "City"}
};

using(var writer = new CsvDataWriter("output.csv", options))
{
    var row = writer.NewRow();
    row["Name"] = "John Doe";
    row["Age"] = "30";
    row["City"] = "New York";
    writer.Write(row);
}
```

## Типы данных
Библиотека поддерживает различные типы данных через перечисление `CsvDbType`:
- String
- Int32
- DateTime
- Boolean
- Byte
- Char
- Decimal
- Double
- Single
- Guid
- Int16
- Int64
- Binary
- Timespan
- DateTimeOffset

## Виртуальные поля
Виртуальные поля позволяют добавлять вычисляемые или производные поля во время чтения без изменения исходного CSV-файла. Вы можете обрабатывать событие `OnGetVirtualColumnValue`, чтобы предоставлять значения для виртуальных полей.

## Обработка ошибок
Библиотека вызывает стандартные исключения .NET при обнаружении неправильно отформатированных данных или ошибок ввода-вывода. FormatExceptions вызываются при неудаче преобразования типов данных.

## Производительность
- Библиотека использует буферизованное чтение для эффективной обработки больших файлов
- Использование памяти масштабируется по ширине CSV (количество столбцов), а не по длине
- Потоки обрабатываются постепенно, чтобы минимизировать использование памяти

## Лицензия
Эта библиотека лицензирована в соответствии с условиями, указанными в файле LICENSE.